<UserControl x:Class="Lemoo.UI.WPF.Controls.ToolboxView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:ui="clr-namespace:Lemoo.UI.Controls;assembly=Lemoo.UI"
             xmlns:models="clr-namespace:Lemoo.UI.Models;assembly=Lemoo.UI"
             xmlns:vm="clr-namespace:Lemoo.UI.WPF.ViewModels"
             xmlns:behaviors="clr-namespace:Lemoo.UI.Behaviors;assembly=Lemoo.UI"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="300"
             d:DataContext="{d:DesignInstance vm:ToolboxViewModel}">

    <UserControl.Resources>
        <!-- 控件项动画故事板 -->
        <Storyboard x:Key="ItemLoadAnimation">
            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
                           From="10"
                           To="0"
                           Duration="{StaticResource AnimationDuration.Normal}"
                           EasingFunction="{StaticResource EasingFunction.EaseOut}" />
            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                           From="0"
                           To="1"
                           Duration="{StaticResource AnimationDuration.Normal}"
                           EasingFunction="{StaticResource EasingFunction.EaseOut}" />
        </Storyboard>

        <!-- 控件项模板 -->
        <DataTemplate x:Key="ControlItemTemplate" DataType="{x:Type models:ControlInfo}">
            <Grid Background="Transparent" RenderTransformOrigin="0.5,0.5">
                <Grid.RenderTransform>
                    <TranslateTransform />
                </Grid.RenderTransform>
                <Grid.Triggers>
                    <EventTrigger RoutedEvent="Loaded">
                        <BeginStoryboard Storyboard="{StaticResource ItemLoadAnimation}" />
                    </EventTrigger>
                </Grid.Triggers>
                <Grid.InputBindings>
                    <MouseBinding MouseAction="LeftClick" Command="{Binding DataContext.SelectControlCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" CommandParameter="{Binding}" />
                </Grid.InputBindings>

                <Border x:Name="ItemBorder"
                        Background="{DynamicResource CardBackgroundBrush}"
                        BorderBrush="{DynamicResource CardBorderBrush}"
                        BorderThickness="1"
                        CornerRadius="6"
                        Padding="14,10"
                        Margin="4,2">
                    <Border.Style>
                        <Style TargetType="Border">
                            <Setter Property="Effect">
                                <Setter.Value>
                                    <DropShadowEffect Color="Black" ShadowDepth="0" BlurRadius="0" Opacity="0" Direction="270" />
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Trigger.EnterActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetProperty="Effect.ShadowDepth"
                                                               To="2"
                                                               Duration="{StaticResource AnimationDuration.Fast}" />
                                                <DoubleAnimation Storyboard.TargetProperty="Effect.BlurRadius"
                                                               To="8"
                                                               Duration="{StaticResource AnimationDuration.Fast}" />
                                                <DoubleAnimation Storyboard.TargetProperty="Effect.Opacity"
                                                               To="0.15"
                                                               Duration="{StaticResource AnimationDuration.Fast}" />
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </Trigger.EnterActions>
                                    <Trigger.ExitActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetProperty="Effect.ShadowDepth"
                                                               To="0"
                                                               Duration="{StaticResource AnimationDuration.Fast}" />
                                                <DoubleAnimation Storyboard.TargetProperty="Effect.BlurRadius"
                                                               To="0"
                                                               Duration="{StaticResource AnimationDuration.Fast}" />
                                                <DoubleAnimation Storyboard.TargetProperty="Effect.Opacity"
                                                               To="0"
                                                               Duration="{StaticResource AnimationDuration.Fast}" />
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </Trigger.ExitActions>
                                    <Setter Property="Background" Value="{DynamicResource CardHoverBackgroundBrush}" />
                                    <Setter Property="BorderBrush" Value="{DynamicResource InputFocusBorderBrush}" />
                                    <Setter Property="BorderThickness" Value="1.5" />
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Border.Style>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <!-- 控件图标 -->
                        <Border Grid.Column="0"
                                x:Name="IconBorder"
                                Width="36" Height="36"
                                Background="{DynamicResource BadgeBackgroundBrush}"
                                CornerRadius="6"
                                Margin="0,0,10,0"
                                RenderTransformOrigin="0.5,0.5">
                            <Border.RenderTransform>
                                <ScaleTransform x:Name="IconScale" ScaleX="1" ScaleY="1" />
                            </Border.RenderTransform>
                            <Path Width="18" Height="18"
                                  Stretch="Uniform"
                                  Fill="{DynamicResource BadgeForegroundBrush}"
                                  Data="{Binding Icon}"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Center"
                                  RenderTransformOrigin="0.5,0.5">
                                <Path.RenderTransform>
                                    <RotateTransform x:Name="IconRotate" Angle="0" />
                                </Path.RenderTransform>
                            </Path>
                        </Border>

                        <!-- 控件信息 -->
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <TextBlock x:Name="DisplayNameText"
                                       Text="{Binding DisplayName}"
                                       FontSize="13"
                                       FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextPrimaryBrush}">
                                <TextBlock.RenderTransform>
                                    <TranslateTransform x:Name="TextTransform" X="0" />
                                </TextBlock.RenderTransform>
                            </TextBlock>
                            <TextBlock x:Name="DescriptionText"
                                       Text="{Binding Description}"
                                       FontSize="11"
                                       Foreground="{DynamicResource TextSecondaryBrush}"
                                       TextTrimming="CharacterEllipsis"
                                       Margin="0,3,0,0"
                                       Opacity="0.85" />
                        </StackPanel>

                        <!-- 控件类型标识 -->
                        <Border Grid.Column="2"
                                x:Name="TypeBadge"
                                Background="{DynamicResource InputBorderBrush}"
                                CornerRadius="3"
                                Padding="5,2.5"
                                VerticalAlignment="Center"
                                Opacity="0.7">
                            <TextBlock Text="{Binding Type, Converter={StaticResource EnumToStringConverter}}"
                                       FontSize="9"
                                       FontWeight="Medium"
                                       Foreground="{DynamicResource TextSecondaryBrush}" />
                        </Border>
                    </Grid>
                </Border>

                <!-- 工具提示 -->
                <ToolTipService.ToolTip>
                    <ToolTip>
                        <Border Background="{DynamicResource CardBackgroundBrush}"
                                BorderBrush="{DynamicResource CardBorderBrush}"
                                BorderThickness="1"
                                CornerRadius="6"
                                Padding="12"
                                Effect="{StaticResource Shadow.Medium}"
                                MaxWidth="280">
                            <StackPanel>
                                <TextBlock Text="{Binding DisplayName}"
                                           FontSize="14"
                                           FontWeight="SemiBold"
                                           Foreground="{DynamicResource TextPrimaryBrush}"
                                           Margin="0,0,0,6" />
                                <TextBlock Text="{Binding Description}"
                                           FontSize="12"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           TextWrapping="Wrap"
                                           Margin="0,0,0,8" />
                                <Border Background="{DynamicResource BadgeBackgroundBrush}"
                                        CornerRadius="3"
                                        Padding="6,3"
                                        HorizontalAlignment="Left">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="分类: "
                                                   FontSize="10"
                                                   Foreground="{DynamicResource TextSecondaryBrush}" />
                                        <TextBlock Text="{Binding Category, Converter={StaticResource CategoryToDisplayNameConverter}}"
                                                   FontSize="10"
                                                   FontWeight="Medium"
                                                   Foreground="{DynamicResource TextPrimaryBrush}" />
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Border>
                    </ToolTip>
                </ToolTipService.ToolTip>
            </Grid>
        </DataTemplate>

        <!-- 搜索结果项模板 -->
        <DataTemplate x:Key="SearchResultTemplate" DataType="{x:Type models:ControlInfo}">
            <Grid Background="Transparent" RenderTransformOrigin="0.5,0.5">
                <Grid.RenderTransform>
                    <TranslateTransform />
                </Grid.RenderTransform>
                <Grid.Triggers>
                    <EventTrigger RoutedEvent="Loaded">
                        <BeginStoryboard Storyboard="{StaticResource ItemLoadAnimation}" />
                    </EventTrigger>
                </Grid.Triggers>
                <Grid.InputBindings>
                    <MouseBinding MouseAction="LeftClick" Command="{Binding DataContext.SelectControlCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" CommandParameter="{Binding}" />
                </Grid.InputBindings>

                <Border x:Name="ItemBorder"
                        Background="{DynamicResource CardBackgroundBrush}"
                        BorderBrush="{DynamicResource CardBorderBrush}"
                        BorderThickness="1"
                        CornerRadius="6"
                        Padding="14,10"
                        Margin="4,2">
                    <Border.Style>
                        <Style TargetType="Border">
                            <Setter Property="Effect">
                                <Setter.Value>
                                    <DropShadowEffect Color="Black" ShadowDepth="0" BlurRadius="0" Opacity="0" Direction="270" />
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Trigger.EnterActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetProperty="Effect.ShadowDepth"
                                                               To="2"
                                                               Duration="{StaticResource AnimationDuration.Fast}" />
                                                <DoubleAnimation Storyboard.TargetProperty="Effect.BlurRadius"
                                                               To="8"
                                                               Duration="{StaticResource AnimationDuration.Fast}" />
                                                <DoubleAnimation Storyboard.TargetProperty="Effect.Opacity"
                                                               To="0.15"
                                                               Duration="{StaticResource AnimationDuration.Fast}" />
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </Trigger.EnterActions>
                                    <Trigger.ExitActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetProperty="Effect.ShadowDepth"
                                                               To="0"
                                                               Duration="{StaticResource AnimationDuration.Fast}" />
                                                <DoubleAnimation Storyboard.TargetProperty="Effect.BlurRadius"
                                                               To="0"
                                                               Duration="{StaticResource AnimationDuration.Fast}" />
                                                <DoubleAnimation Storyboard.TargetProperty="Effect.Opacity"
                                                               To="0"
                                                               Duration="{StaticResource AnimationDuration.Fast}" />
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </Trigger.ExitActions>
                                    <Setter Property="Background" Value="{DynamicResource CardHoverBackgroundBrush}" />
                                    <Setter Property="BorderBrush" Value="{DynamicResource InputFocusBorderBrush}" />
                                    <Setter Property="BorderThickness" Value="1.5" />
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Border.Style>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <!-- 控件图标 -->
                        <Border Grid.Column="0"
                                x:Name="IconBorder"
                                Width="36" Height="36"
                                Background="{DynamicResource BadgeBackgroundBrush}"
                                CornerRadius="6"
                                Margin="0,0,10,0">
                            <Path Width="18" Height="18"
                                  Stretch="Uniform"
                                  Fill="{DynamicResource BadgeForegroundBrush}"
                                  Data="{Binding Icon}"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Center" />
                        </Border>

                        <!-- 控件信息 -->
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <TextBlock Text="{Binding DisplayName}"
                                       FontSize="13"
                                       FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextPrimaryBrush}" />
                            <TextBlock FontSize="11"
                                       Foreground="{DynamicResource TextSecondaryBrush}"
                                       Margin="0,3,0,0"
                                       Opacity="0.85">
                                <Run Text="{Binding Description}" />
                                <Run Text=" (" />
                                <Run Text="{Binding Category, Converter={StaticResource CategoryToDisplayNameConverter}}" />
                                <Run Text=")" />
                            </TextBlock>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- 工具提示 -->
                <ToolTipService.ToolTip>
                    <ToolTip>
                        <Border Background="{DynamicResource CardBackgroundBrush}"
                                BorderBrush="{DynamicResource CardBorderBrush}"
                                BorderThickness="1"
                                CornerRadius="6"
                                Padding="12"
                                Effect="{StaticResource Shadow.Medium}"
                                MaxWidth="280">
                            <StackPanel>
                                <TextBlock Text="{Binding DisplayName}"
                                           FontSize="14"
                                           FontWeight="SemiBold"
                                           Foreground="{DynamicResource TextPrimaryBrush}"
                                           Margin="0,0,0,6" />
                                <TextBlock Text="{Binding Description}"
                                           FontSize="12"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           TextWrapping="Wrap"
                                           Margin="0,0,0,8" />
                                <Border Background="{DynamicResource BadgeBackgroundBrush}"
                                        CornerRadius="3"
                                        Padding="6,3"
                                        HorizontalAlignment="Left">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="分类: "
                                                   FontSize="10"
                                                   Foreground="{DynamicResource TextSecondaryBrush}" />
                                        <TextBlock Text="{Binding Category, Converter={StaticResource CategoryToDisplayNameConverter}}"
                                                   FontSize="10"
                                                   FontWeight="Medium"
                                                   Foreground="{DynamicResource TextPrimaryBrush}" />
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Border>
                    </ToolTip>
                </ToolTipService.ToolTip>
            </Grid>
        </DataTemplate>

        <!-- 分类组模板 -->
        <GroupStyle x:Key="CategoryGroupStyle">
            <GroupStyle.ContainerStyle>
                <Style TargetType="{x:Type GroupItem}">
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate>
                                <Expander x:Name="CategoryExpander"
                                          IsExpanded="True"
                                          Style="{StaticResource {x:Type Expander}}"
                                          Background="Transparent"
                                          BorderThickness="0"
                                          Margin="0,8,0,0"
                                          RenderTransformOrigin="0.5,0.5">
                                    <Expander.RenderTransform>
                                        <ScaleTransform x:Name="ExpanderScale" ScaleX="1" ScaleY="1" />
                                    </Expander.RenderTransform>
                                    <Expander.Header>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>

                                            <!-- 分类指示器 -->
                                            <Border Grid.Column="0"
                                                    Width="4"
                                                    Height="20"
                                                    Background="{DynamicResource InputFocusBorderBrush}"
                                                    CornerRadius="2"
                                                    VerticalAlignment="Center"
                                                    Margin="0,0,10,0"
                                                    RenderTransformOrigin="0.5,0.5">
                                                <Border.RenderTransform>
                                                    <ScaleTransform x:Name="IndicatorScale" ScaleX="1" ScaleY="1" />
                                                </Border.RenderTransform>
                                            </Border>

                                            <TextBlock Grid.Column="1"
                                                       x:Name="CategoryNameText"
                                                       Text="{Binding Name, Converter={StaticResource CategoryToDisplayNameConverter}}"
                                                       FontSize="14"
                                                       FontWeight="SemiBold"
                                                       Foreground="{DynamicResource TextPrimaryBrush}"
                                                       VerticalAlignment="Center" />

                                            <Border Grid.Column="2"
                                                    x:Name="CountBadge"
                                                    Background="{DynamicResource BadgeBackgroundBrush}"
                                                    CornerRadius="10"
                                                    Padding="8,3"
                                                    Margin="8,0,0,0"
                                                    Effect="{x:Null}">
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Style.Triggers>
                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                <Setter Property="Effect" Value="{StaticResource Shadow.Small}" />
                                                            </Trigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                                <TextBlock Text="{Binding ItemCount}"
                                                           FontSize="11"
                                                           FontWeight="SemiBold"
                                                           Foreground="{DynamicResource BadgeForegroundBrush}" />
                                            </Border>
                                        </Grid>
                                    </Expander.Header>
                                    <ItemsPresenter />
                                </Expander>
                                <ControlTemplate.Triggers>
                                    <Trigger SourceName="CategoryExpander" Property="IsMouseOver" Value="True">
                                        <Trigger.EnterActions>
                                            <BeginStoryboard>
                                                <Storyboard>
                                                    <DoubleAnimation Storyboard.TargetName="IndicatorScale"
                                                                   Storyboard.TargetProperty="ScaleX"
                                                                   To="1.2"
                                                                   Duration="{StaticResource AnimationDuration.Fast}"
                                                                   EasingFunction="{StaticResource EasingFunction.EaseOut}" />
                                                    <DoubleAnimation Storyboard.TargetName="IndicatorScale"
                                                                   Storyboard.TargetProperty="ScaleY"
                                                                   To="1.1"
                                                                   Duration="{StaticResource AnimationDuration.Fast}"
                                                                   EasingFunction="{StaticResource EasingFunction.EaseOut}" />
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </Trigger.EnterActions>
                                        <Trigger.ExitActions>
                                            <BeginStoryboard>
                                                <Storyboard>
                                                    <DoubleAnimation Storyboard.TargetName="IndicatorScale"
                                                                   Storyboard.TargetProperty="ScaleX"
                                                                   To="1"
                                                                   Duration="{StaticResource AnimationDuration.Fast}"
                                                                   EasingFunction="{StaticResource EasingFunction.EaseOut}" />
                                                    <DoubleAnimation Storyboard.TargetName="IndicatorScale"
                                                                   Storyboard.TargetProperty="ScaleY"
                                                                   To="1"
                                                                   Duration="{StaticResource AnimationDuration.Fast}"
                                                                   EasingFunction="{StaticResource EasingFunction.EaseOut}" />
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </Trigger.ExitActions>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </GroupStyle.ContainerStyle>
        </GroupStyle>
    </UserControl.Resources>

    <Grid Background="{DynamicResource LayerBackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- 搜索栏 -->
        <Border Grid.Row="0"
                x:Name="SearchBarBorder"
                Background="{DynamicResource CardBackgroundBrush}"
                BorderBrush="{DynamicResource CardBorderBrush}"
                BorderThickness="0,0,0,1"
                Padding="16,12"
                Effect="{x:Null}">
            <Border.Style>
                <Style TargetType="Border">
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsSearching}" Value="True">
                            <Setter Property="Effect" Value="{StaticResource Shadow.Small}" />
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Border.Style>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!-- 使用自定义SearchBox控件 -->
                <ui:SearchBox Grid.Column="0"
                             x:Name="MainSearchBox"
                             Text="{Binding SearchKeyword, UpdateSourceTrigger=PropertyChanged}"
                             PlaceholderText="搜索控件..."
                             FontSize="13"
                             VerticalAlignment="Center"
                             Height="38">
                    <ui:SearchBox.Style>
                        <Style BasedOn="{StaticResource {x:Type ui:SearchBox}}" TargetType="ui:SearchBox">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsSearching}" Value="True">
                                    <Setter Property="BorderBrush" Value="{DynamicResource InputFocusBorderBrush}" />
                                    <Setter Property="BorderThickness" Value="1.5" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </ui:SearchBox.Style>
                </ui:SearchBox>
            </Grid>
        </Border>

        <!-- 控件列表 -->
        <ScrollViewer Grid.Row="1"
                      x:Name="MainScrollViewer"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled"
                      Padding="12,8">
            <Grid>
                <!-- 搜索结果 -->
                <StackPanel Visibility="{Binding IsSearching, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <!-- 搜索结果计数 -->
                    <Border x:Name="ResultCountBorder"
                            Background="{DynamicResource BadgeBackgroundBrush}"
                            CornerRadius="6"
                            Padding="10,5"
                            Margin="0,0,0,10"
                            HorizontalAlignment="Stretch"
                            Effect="{x:Null}"
                            RenderTransformOrigin="0.5,0.5">
                        <Border.RenderTransform>
                            <ScaleTransform x:Name="CountScale" ScaleX="1" ScaleY="1" />
                        </Border.RenderTransform>
                        <Border.Style>
                            <Style TargetType="Border">
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Effect" Value="{StaticResource Shadow.Small}" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Path Grid.Column="0"
                                  Width="16"
                                  Height="16"
                                  Stretch="Uniform"
                                  Fill="{DynamicResource BadgeForegroundBrush}"
                                  Margin="0,0,8,0"
                                  Data="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                                  VerticalAlignment="Center" />

                            <TextBlock Grid.Column="1"
                                       VerticalAlignment="Center">
                                <Run Text="找到" />
                                <Run Text="{Binding SearchResultCount, Mode=OneWay}" FontWeight="SemiBold" />
                                <Run Text="个相关控件" />
                            </TextBlock>

                            <!-- 清除搜索按钮 -->
                            <Button Grid.Column="2"
                                    x:Name="ClearSearchButton"
                                    Command="{Binding ClearSearchCommand}"
                                    Padding="6,3"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Cursor="Hand"
                                    ToolTip="清除搜索">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border x:Name="ButtonBorder"
                                                            Background="{TemplateBinding Background}"
                                                            BorderThickness="0"
                                                            CornerRadius="3"
                                                            Padding="{TemplateBinding Padding}">
                                                        <Path Width="14"
                                                              Height="14"
                                                              Stretch="Uniform"
                                                              Fill="{DynamicResource TextSecondaryBrush}"
                                                              Data="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" />
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="ButtonBorder" Property="Background" Value="{DynamicResource ButtonHoverBackgroundBrush}" />
                                                        </Trigger>
                                                        <Trigger Property="IsPressed" Value="True">
                                                            <Setter TargetName="ButtonBorder" Property="Background" Value="{DynamicResource ButtonPressedBackgroundBrush}" />
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </Grid>
                    </Border>

                    <!-- 搜索结果列表 -->
                    <ItemsControl ItemsSource="{Binding SearchResults}"
                                  ItemTemplate="{StaticResource SearchResultTemplate}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                    </ItemsControl>

                    <!-- 无结果提示 -->
                    <Border x:Name="NoResultBorder"
                            Visibility="{Binding HasSearchResults, Converter={StaticResource InverseBooleanToVisibilityConverter}}"
                            Background="{DynamicResource CardBackgroundBrush}"
                            BorderBrush="{DynamicResource CardBorderBrush}"
                            BorderThickness="1"
                            CornerRadius="10"
                            Padding="32,24"
                            Margin="0,16,0,0"
                            HorizontalAlignment="Stretch"
                            Effect="{x:Null}"
                            RenderTransformOrigin="0.5,0.5">
                        <Border.RenderTransform>
                            <ScaleTransform x:Name="NoResultScale" ScaleX="0.95" ScaleY="0.95" />
                        </Border.RenderTransform>
                        <Border.Style>
                            <Style TargetType="Border">
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Effect" Value="{StaticResource Shadow.Medium}" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>
                        <Border.Triggers>
                            <EventTrigger RoutedEvent="Loaded">
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="NoResultScale"
                                                       Storyboard.TargetProperty="ScaleX"
                                                       From="0.95"
                                                       To="1"
                                                       Duration="{StaticResource AnimationDuration.Normal}"
                                                       EasingFunction="{StaticResource EasingFunction.EaseOut}" />
                                        <DoubleAnimation Storyboard.TargetName="NoResultScale"
                                                       Storyboard.TargetProperty="ScaleY"
                                                       From="0.95"
                                                       To="1"
                                                       Duration="{StaticResource AnimationDuration.Normal}"
                                                       EasingFunction="{StaticResource EasingFunction.EaseOut}" />
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                        </Border.Triggers>
                        <StackPanel HorizontalAlignment="Center">
                            <Path Width="56"
                                  Height="56"
                                  Stretch="Uniform"
                                  Fill="{DynamicResource TextSecondaryBrush}"
                                  Opacity="0.4"
                                  Margin="0,0,0,16"
                                  HorizontalAlignment="Center"
                                  Data="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                                  RenderTransformOrigin="0.5,0.5">
                                <Path.RenderTransform>
                                    <RotateTransform x:Name="SearchIconRotate" Angle="0" />
                                </Path.RenderTransform>
                            </Path>
                            <TextBlock Text="未找到匹配的控件"
                                       FontSize="15"
                                       FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextPrimaryBrush}"
                                       HorizontalAlignment="Center"
                                       Margin="0,0,0,6"/>
                            <TextBlock Text="请尝试其他关键词或检查拼写"
                                       FontSize="12"
                                       Foreground="{DynamicResource TextSecondaryBrush}"
                                       HorizontalAlignment="Center"
                                       Opacity="0.8"/>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- 分类列表 -->
                <ItemsControl ItemsSource="{Binding GroupedControls}"
                              ItemTemplate="{StaticResource ControlItemTemplate}"
                              Visibility="{Binding IsSearching, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.GroupStyle>
                        <StaticResource ResourceKey="CategoryGroupStyle" />
                    </ItemsControl.GroupStyle>
                </ItemsControl>
            </Grid>
        </ScrollViewer>
    </Grid>
</UserControl>
