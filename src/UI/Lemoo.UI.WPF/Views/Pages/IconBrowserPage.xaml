<Page x:Class="Lemoo.UI.WPF.Views.Pages.IconBrowserPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:icons="clr-namespace:Lemoo.UI.Controls.Icons;assembly=Lemoo.UI"
      xmlns:converters="clr-namespace:Lemoo.UI.WPF.Converters"
      xmlns:viewmodels="clr-namespace:Lemoo.UI.WPF.ViewModels.Pages"
      xmlns:models="clr-namespace:Lemoo.UI.Models.Icons;assembly=Lemoo.UI"
      xmlns:layout="clr-namespace:Lemoo.UI.Controls.Layout;assembly=Lemoo.UI"
      mc:Ignorable="d"
      d:DesignWidth="1280"
      d:DesignHeight="720"
      Background="Transparent"
      d:DataContext="{d:DesignInstance Type=viewmodels:IconBrowserPageViewModel, IsDesignTimeCreatable=True}">

    <Page.Resources>
        <!-- 转换器资源 -->
        <converters:DensityToProgressConverter x:Key="DensityToProgressConverter" />
        <converters:DensityToMarginConverter x:Key="DensityToMarginConverter" />

        <!-- 自定义 TextBox 样式，带主题色光标和占位符 -->
        <Style x:Key="ThemedTextBox" TargetType="TextBox">
            <Setter Property="CaretBrush" Value="{DynamicResource AccentPrimaryBrush}" />
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Foreground" Value="{DynamicResource InputForegroundBrush}" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Grid>
                            <!-- 占位符文本 -->
                            <TextBlock x:Name="PlaceholderText"
                                       Text="{TemplateBinding Tag}"
                                       Foreground="{DynamicResource InputForegroundBrush}"
                                       Opacity="0.5"
                                       FontSize="{TemplateBinding FontSize}"
                                       VerticalAlignment="Center"
                                       Margin="0"
                                       Visibility="Collapsed" />
                            <!-- 内容宿主 -->
                            <ScrollViewer x:Name="PART_ContentHost"
                                          Margin="0"
                                          HorizontalAlignment="Stretch"
                                          VerticalAlignment="Stretch"
                                          Background="{TemplateBinding Background}"
                                          BorderThickness="0" />
                        </Grid>
                        <ControlTemplate.Triggers>
                            <!-- 当文本为空时显示占位符 -->
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="Text" Value="" />
                                    <Condition Property="IsKeyboardFocusWithin" Value="False" />
                                </MultiTrigger.Conditions>
                                <Setter TargetName="PlaceholderText" Property="Visibility" Value="Visible" />
                            </MultiTrigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 图标项样式 -->
        <Style x:Key="IconItemContainerStyle" TargetType="Border">
            <Setter Property="Background" Value="{DynamicResource InputBackgroundBrush}" />
            <Setter Property="BorderBrush" Value="{DynamicResource InputBorderBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Padding" Value="12" />
            <Setter Property="Margin" Value="6" />
            <Setter Property="Cursor" Value="Hand" />
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{DynamicResource ButtonHoverBackgroundBrush}" />
                    <Setter Property="BorderBrush" Value="{DynamicResource AccentPrimaryBrush}" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- ListBoxItem 样式 - 带选中状态 -->
        <Style x:Key="IconListBoxItemStyle" TargetType="ListBoxItem">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="Margin" Value="0" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <ContentPresenter />
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 选中状态的 Border 样式 -->
        <Style x:Key="IconItemBorderStyle" TargetType="Border">
            <Setter Property="Background" Value="{DynamicResource InputBackgroundBrush}" />
            <Setter Property="BorderBrush" Value="{DynamicResource InputBorderBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Padding" Value="6" />
            <Setter Property="Margin" Value="0" />
            <Style.Triggers>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=ListBoxItem}, Path=IsSelected}" Value="True">
                    <Setter Property="Background" Value="{DynamicResource AccentPrimaryBrush}" />
                    <Setter Property="BorderBrush" Value="{DynamicResource AccentPrimaryBrush}" />
                    <Setter Property="BorderThickness" Value="2" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- 选中状态的图标样式 -->
        <Style x:Key="IconItemIconStyle" TargetType="icons:Icon">
            <Setter Property="Foreground" Value="{DynamicResource InputForegroundBrush}" />
            <Style.Triggers>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=ListBoxItem}, Path=IsSelected}" Value="True">
                    <Setter Property="Foreground" Value="{DynamicResource OnAccentForegroundBrush}" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- 分类按钮样式 -->
        <Style x:Key="CategoryButtonStyle" TargetType="RadioButton">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Foreground" Value="{DynamicResource InputForegroundBrush}" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Padding" Value="16,8" />
            <Setter Property="Margin" Value="4,4,0,4" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Border x:Name="RootBorder"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="6"
                                Padding="{TemplateBinding Padding}"
                                Margin="{TemplateBinding Margin}">
                            <ContentPresenter x:Name="ContentPresenter"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="RootBorder" Property="Background" Value="{DynamicResource ButtonHoverBackgroundBrush}" />
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="RootBorder" Property="Background" Value="{DynamicResource AccentPrimaryBrush}" />
                                <Setter TargetName="ContentPresenter" Property="TextElement.Foreground" Value="{DynamicResource OnAccentForegroundBrush}" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 密度滑块Thumb模板 -->
        <ControlTemplate x:Key="DensityThumbTemplate" TargetType="Thumb">
            <Grid>
                <!-- 外圈光晕 -->
                <Ellipse Width="20"
                         Height="20"
                         Fill="{DynamicResource AccentPrimaryBrush}"
                         Opacity="0.2"
                         HorizontalAlignment="Center"
                         VerticalAlignment="Center">
                    <Ellipse.RenderTransform>
                        <ScaleTransform x:Name="GlowScale" ScaleX="1" ScaleY="1" />
                    </Ellipse.RenderTransform>
                    <Ellipse.Triggers>
                        <EventTrigger RoutedEvent="Thumb.DragStarted">
                            <BeginStoryboard>
                                <Storyboard>
                                    <DoubleAnimation Storyboard.TargetName="GlowScale"
                                                   Storyboard.TargetProperty="ScaleX"
                                                   To="1.5" Duration="0:0:0.2">
                                        <DoubleAnimation.EasingFunction>
                                            <CircleEase EasingMode="EaseOut" />
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                    <DoubleAnimation Storyboard.TargetName="GlowScale"
                                                   Storyboard.TargetProperty="ScaleY"
                                                   To="1.5" Duration="0:0:0.2">
                                        <DoubleAnimation.EasingFunction>
                                            <CircleEase EasingMode="EaseOut" />
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger>
                        <EventTrigger RoutedEvent="Thumb.DragCompleted">
                            <BeginStoryboard>
                                <Storyboard>
                                    <DoubleAnimation Storyboard.TargetName="GlowScale"
                                                   Storyboard.TargetProperty="ScaleX"
                                                   To="1" Duration="0:0:0.3" />
                                    <DoubleAnimation Storyboard.TargetName="GlowScale"
                                                   Storyboard.TargetProperty="ScaleY"
                                                   To="1" Duration="0:0:0.3" />
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger>
                    </Ellipse.Triggers>
                </Ellipse>

                <!-- 滑块主体 -->
                <Ellipse Width="14"
                         Height="14"
                         Fill="{DynamicResource AccentPrimaryBrush}"
                         Stroke="{DynamicResource WorkbenchSurfaceBrush}"
                         StrokeThickness="2"
                         HorizontalAlignment="Center"
                         VerticalAlignment="Center">
                    <Ellipse.Effect>
                        <DropShadowEffect Color="{DynamicResource AccentPrimaryColor}"
                                        BlurRadius="8"
                                        ShadowDepth="0"
                                        Opacity="0.4" />
                    </Ellipse.Effect>
                </Ellipse>
            </Grid>
        </ControlTemplate>

        <!-- 复制图标按钮样式 -->
        <Style x:Key="CopyIconButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Foreground" Value="{DynamicResource InputForegroundBrush}" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Padding" Value="6" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Width" Value="28" />
            <Setter Property="Height" Value="28" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="RootBorder"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}"
                                Width="{TemplateBinding Width}"
                                Height="{TemplateBinding Height}">
                            <ContentPresenter x:Name="ContentPresenter"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="RootBorder" Property="Background" Value="{DynamicResource ButtonHoverBackgroundBrush}" />
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="RootBorder" Property="Background" Value="{DynamicResource InputBorderBrush}" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Page.Resources>

    <Grid Margin="24,24,24,24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- 标题 -->
        <TextBlock Grid.Row="0"
                   Text="图标浏览器"
                   FontSize="24"
                   FontWeight="SemiBold"
                   Foreground="{DynamicResource InputForegroundBrush}"
                   Margin="0,0,0,16" />

        <!-- 搜索和分类栏 -->
        <Border Grid.Row="1"
                Background="{DynamicResource WorkbenchSurfaceBrush}"
                BorderBrush="{DynamicResource InputBorderBrush}"
                BorderThickness="1"
                CornerRadius="8"
                Padding="8,8,8,8"
                Margin="0,0,0,16">
            <Grid MaxWidth="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Border}}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- 搜索框和尺寸选择 -->
                <Grid Grid.Row="0" Margin="0,0,0,12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- 搜索框 -->
                    <Border Grid.Column="0"
                            Background="{DynamicResource InputBackgroundBrush}"
                            BorderBrush="{DynamicResource InputBorderBrush}"
                            BorderThickness="1"
                            CornerRadius="6"
                            MinWidth="300">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <!-- 搜索图标 -->
                            <icons:Icon Grid.Column="0"
                                        IconKind="Search"
                                        IconSize="Small"
                                        Foreground="{DynamicResource InputForegroundBrush}"
                                        Opacity="0.5"
                                        VerticalAlignment="Center"
                                        Margin="12,0,8,0" />

                            <!-- 输入框 -->
                            <TextBox x:Name="SearchTextBox"
                                     Grid.Column="1"
                                     Style="{StaticResource ThemedTextBox}"
                                     Tag="搜索图标..."
                                     TextChanged="OnSearchTextChanged" />

                            <!-- 清空按钮 -->
                            <Button x:Name="ClearSearchButton"
                                    Grid.Column="2"
                                    Click="OnClearSearchClick"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Padding="6"
                                    Margin="0,0,8,0"
                                    Cursor="Hand"
                                    ToolTip="清空"
                                    Visibility="Collapsed">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}"
                                                BorderThickness="0"
                                                Padding="{TemplateBinding Padding}"
                                                CornerRadius="4"
                                                Width="20"
                                                Height="20">
                                            <icons:Icon IconKind="Clear"
                                                        IconSize="ExtraSmall"
                                                        Foreground="{DynamicResource InputForegroundBrush}"
                                                        Opacity="0.5" />
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="{DynamicResource ButtonHoverBackgroundBrush}" />
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                        </Grid>
                    </Border>

                    <!-- 显示密度滑块 -->
                    <Border Grid.Column="1"
                            Background="Transparent"
                            Margin="16,4,0,4"
                            VerticalAlignment="Center"
                            Padding="12,6">
                        <StackPanel Orientation="Horizontal">
                            <!-- 标签 -->
                            <TextBlock Text="密度:"
                                       Foreground="{DynamicResource InputForegroundBrush}"
                                       Opacity="0.7"
                                       FontSize="12"
                                       VerticalAlignment="Center"
                                       Margin="0,0,8,0" />

                            <!-- 滑块容器 -->
                            <Grid Width="120" Height="20" x:Name="DensitySliderTrack">
                                <!-- 轨道背景 -->
                                <Border Height="3"
                                        VerticalAlignment="Center"
                                        Background="{DynamicResource InputBorderBrush}"
                                        Opacity="0.3"
                                        CornerRadius="1.5" />

                                <!-- 已通过区域 -->
                                <Border Height="3"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Left"
                                        Background="{DynamicResource AccentPrimaryBrush}"
                                        CornerRadius="1.5">
                                    <Border.Width>
                                        <MultiBinding Converter="{StaticResource DensityToProgressConverter}">
                                            <Binding Path="DensityValue" />
                                            <Binding ElementName="DensitySliderTrack" Path="ActualWidth" FallbackValue="120" />
                                        </MultiBinding>
                                    </Border.Width>
                                </Border>

                                <!-- 滑块按钮 -->
                                <Thumb x:Name="DensityThumb"
                                       Width="14"
                                       Height="14"
                                       HorizontalAlignment="Left"
                                       VerticalAlignment="Center"
                                       Cursor="SizeWE"
                                       Template="{StaticResource DensityThumbTemplate}"
                                       DragDelta="OnDensityThumbDragDelta">
                                    <Thumb.Margin>
                                        <MultiBinding Converter="{StaticResource DensityToMarginConverter}">
                                            <Binding Path="DensityValue" />
                                            <Binding ElementName="DensitySliderTrack" Path="ActualWidth" FallbackValue="120" />
                                        </MultiBinding>
                                    </Thumb.Margin>
                                </Thumb>
                            </Grid>

                            <!-- 当前尺寸显示 -->
                            <TextBlock Text="{Binding CardSize, StringFormat={}{0:F0}px}"
                                       Foreground="{DynamicResource AccentPrimaryBrush}"
                                       FontSize="11"
                                       FontFamily="Consolas"
                                       VerticalAlignment="Center"
                                       Margin="8,0,0,0"
                                       Opacity="0.8" />
                        </StackPanel>
                    </Border>
                </Grid>

                <!-- 分类标签 -->
                <ScrollViewer Grid.Row="1"
                              HorizontalScrollBarVisibility="Auto"
                              VerticalScrollBarVisibility="Disabled">
                    <ItemsControl ItemsSource="{Binding Categories}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate DataType="{x:Type viewmodels:IconCategoryItemViewModel}">
                                <RadioButton Style="{StaticResource CategoryButtonStyle}"
                                             Content="{Binding DisplayName}"
                                             GroupName="Category"
                                             IsChecked="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}"
                                             Click="OnCategoryClick" />
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </Border>

        <!-- 主内容区域：图标列表 + 详情面板 -->
        <Grid Grid.Row="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- 内容区域：图标列表 + 详情面板 -->
            <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="3*" />
                    <ColumnDefinition Width="16" />
                    <ColumnDefinition Width="340" />
                </Grid.ColumnDefinitions>

                <!-- 图标网格 -->
                <Border Grid.Column="0"
                        Background="{DynamicResource WorkbenchSurfaceBrush}"
                        BorderBrush="{DynamicResource InputBorderBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="16">
                    <ListBox x:Name="IconListBox"
                             ItemsSource="{Binding FilteredIcons}"
                             SelectedItem="{Binding SelectedIcon, Mode=TwoWay}"
                             SelectionMode="Single"
                             Background="Transparent"
                             BorderThickness="0"
                             ScrollViewer.CanContentScroll="True"
                             VirtualizingPanel.IsVirtualizing="True"
                             VirtualizingPanel.VirtualizationMode="Recycling"
                             ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                             ScrollViewer.VerticalScrollBarVisibility="Auto"
                             ItemContainerStyle="{StaticResource IconListBoxItemStyle}">
                        <ListBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <layout:VirtualizingWrapPanel ChildWidth="{Binding CardSize}"
                                                              ChildHeight="{Binding CardSize}"
                                                              ItemHorizontalSpacing="8"
                                                              ItemVerticalSpacing="8" />
                            </ItemsPanelTemplate>
                        </ListBox.ItemsPanel>
                        <ListBox.ItemTemplate>
                            <DataTemplate DataType="{x:Type models:IconInfo}">
                                <Border Width="{Binding DataContext.CardSize, RelativeSource={RelativeSource AncestorType=Page}}"
                                        Height="{Binding DataContext.CardSize, RelativeSource={RelativeSource AncestorType=Page}}"
                                        Style="{StaticResource IconItemBorderStyle}">
                                    <StackPanel VerticalAlignment="Center">
                                        <TextBlock Text="{Binding Kind, Converter={StaticResource IconKindToGlyphConverter}}"
                                                   FontFamily="{StaticResource FontFamily.Icon}"
                                                   FontSize="{Binding DataContext.DisplayIconSize, RelativeSource={RelativeSource AncestorType=Page}}"
                                                   HorizontalAlignment="Center"
                                                   Margin="0,4,0,8"
                                                   TextOptions.TextFormattingMode="Display"
                                                   TextOptions.TextRenderingMode="Auto">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Foreground" Value="{DynamicResource InputForegroundBrush}" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=ListBoxItem}, Path=IsSelected}" Value="True">
                                                            <Setter Property="Foreground" Value="{DynamicResource OnAccentForegroundBrush}" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                        <TextBlock Text="{Binding Name}"
                                                   FontSize="{Binding DataContext.NameSize, RelativeSource={RelativeSource AncestorType=Page}}"
                                                   Opacity="0.7"
                                                   TextAlignment="Center"
                                                   TextTrimming="CharacterEllipsis"
                                                   Margin="6,0,6,8">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Foreground" Value="{DynamicResource InputForegroundBrush}" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=ListBoxItem}, Path=IsSelected}" Value="True">
                                                            <Setter Property="Foreground" Value="{DynamicResource OnAccentForegroundBrush}" />
                                                            <Setter Property="Opacity" Value="1.0" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Border>

            <!-- 图标详情面板 -->
            <Border Grid.Column="2"
                    Background="{DynamicResource WorkbenchSurfaceBrush}"
                    BorderBrush="{DynamicResource InputBorderBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="16,0,16,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <!-- 标题栏 -->
                    <Border Grid.Row="0"
                            BorderBrush="{DynamicResource InputBorderBrush}"
                            BorderThickness="0,0,0,1"
                            Padding="0,12,0,12">
                        <TextBlock Text="图标详情"
                                   FontSize="14"
                                   FontWeight="SemiBold"
                                   Foreground="{DynamicResource InputForegroundBrush}" />
                    </Border>

                    <!-- 内容区域 -->
                    <ScrollViewer Grid.Row="1"
                                  VerticalScrollBarVisibility="Auto"
                                  Padding="0,16,0,16">
                        <StackPanel>
                            <!-- 图标预览区 -->
                            <Border x:Name="PreviewContainer"
                                    Background="{DynamicResource InputBackgroundBrush}"
                                    BorderBrush="{DynamicResource InputBorderBrush}"
                                    BorderThickness="1"
                                    CornerRadius="8"
                                    Padding="20"
                                    Margin="0,0,0,16">
                                <Grid>
                                    <!-- 主预览 -->
                                    <icons:Icon x:Name="DetailIcon"
                                                IconKind="None"
                                                IconSize="ExtraLarge"
                                                Foreground="{DynamicResource AccentPrimaryBrush}"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center" />

                                    <!-- 空状态提示 -->
                                    <StackPanel x:Name="EmptyState"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Visibility="Collapsed">
                                        <icons:Icon IconKind="Info"
                                                    IconSize="Medium"
                                                    Foreground="{DynamicResource InputForegroundBrush}"
                                                    Opacity="0.4"
                                                    HorizontalAlignment="Center"
                                                    Margin="0,0,0,8" />
                                        <TextBlock Text="点击左侧图标查看详情"
                                                   Foreground="{DynamicResource InputForegroundBrush}"
                                                   Opacity="0.5"
                                                   FontSize="12"
                                                   HorizontalAlignment="Center" />
                                    </StackPanel>
                                </Grid>
                            </Border>

                            <!-- 颜色预览 -->
                            <Border x:Name="ColorPreviewContainer"
                                    Background="{DynamicResource InputBackgroundBrush}"
                                    BorderBrush="{DynamicResource InputBorderBrush}"
                                    BorderThickness="1"
                                    CornerRadius="8"
                                    Padding="12"
                                    Margin="0,0,0,16"
                                    Visibility="Collapsed">
                                <StackPanel>
                                    <TextBlock Text="颜色预览"
                                               Foreground="{DynamicResource InputForegroundBrush}"
                                               Opacity="0.7"
                                               FontSize="11"
                                               Margin="0,0,0,8" />
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <Border Grid.Column="0"
                                                Background="#FF212121"
                                                CornerRadius="4"
                                                Padding="12"
                                                Margin="4">
                                            <icons:Icon x:Name="ColorPreviewDark"
                                                        IconKind="None"
                                                        IconSize="Medium"
                                                        Foreground="#FFFFFFFF" />
                                        </Border>
                                        <Border Grid.Column="1"
                                                Background="{DynamicResource AccentPrimaryBrush}"
                                                CornerRadius="4"
                                                Padding="12"
                                                Margin="4">
                                            <icons:Icon x:Name="ColorPreviewAccent"
                                                        IconKind="None"
                                                        IconSize="Medium"
                                                        Foreground="{DynamicResource OnAccentForegroundBrush}" />
                                        </Border>
                                        <Border Grid.Column="2"
                                                Background="#FFFFFFFF"
                                                BorderBrush="{DynamicResource InputBorderBrush}"
                                                BorderThickness="1"
                                                CornerRadius="4"
                                                Padding="12"
                                                Margin="4">
                                            <icons:Icon x:Name="ColorPreviewLight"
                                                        IconKind="None"
                                                        IconSize="Medium"
                                                        Foreground="#FF212121" />
                                        </Border>
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <!-- 图标信息 -->
                            <StackPanel x:Name="InfoContainer" Visibility="Collapsed">
                                <!-- 图标名称 -->
                                <StackPanel Margin="0,0,0,12">
                                    <TextBlock Text="名称"
                                               Foreground="{DynamicResource InputForegroundBrush}"
                                               Opacity="0.6"
                                               FontSize="11"
                                               Margin="0,0,0,4" />
                                    <TextBlock x:Name="DetailName"
                                               Text="-"
                                               Foreground="{DynamicResource InputForegroundBrush}"
                                               FontSize="14"
                                               FontWeight="SemiBold" />
                                </StackPanel>

                                <!-- 图标分类 -->
                                <StackPanel Margin="0,0,0,12">
                                    <TextBlock Text="分类"
                                               Foreground="{DynamicResource InputForegroundBrush}"
                                               Opacity="0.6"
                                               FontSize="11"
                                               Margin="0,0,0,4" />
                                    <TextBlock x:Name="DetailCategory"
                                               Text="-"
                                               Foreground="{DynamicResource InputForegroundBrush}"
                                               FontSize="13" />
                                </StackPanel>

                                <!-- 图标代码 -->
                                <StackPanel Margin="0,0,0,12">
                                    <TextBlock Text="图标代码"
                                               Foreground="{DynamicResource InputForegroundBrush}"
                                               Opacity="0.6"
                                               FontSize="11"
                                               Margin="0,0,0,4" />
                                    <Grid>
                                        <Border Background="{DynamicResource InputBackgroundBrush}"
                                                BorderBrush="{DynamicResource InputBorderBrush}"
                                                BorderThickness="1"
                                                CornerRadius="4"
                                                Padding="8,6">
                                            <TextBlock x:Name="DetailKind"
                                                       Text="-"
                                                       Foreground="{DynamicResource InputForegroundBrush}"
                                                       FontFamily="Consolas"
                                                       FontSize="12" />
                                        </Border>
                                        <Button x:Name="CopyKindButton"
                                                Style="{StaticResource CopyIconButton}"
                                                Click="OnCopyKindClick"
                                                Margin="0,0,4,0"
                                                HorizontalAlignment="Right"
                                                VerticalAlignment="Center">
                                            <icons:Icon IconKind="Copy"
                                                        IconSize="ExtraSmall"
                                                        Foreground="{DynamicResource InputForegroundBrush}" />
                                        </Button>
                                    </Grid>
                                </StackPanel>

                                <!-- Unicode -->
                                <StackPanel Margin="0,0,0,12">
                                    <TextBlock Text="Unicode"
                                               Foreground="{DynamicResource InputForegroundBrush}"
                                               Opacity="0.6"
                                               FontSize="11"
                                               Margin="0,0,0,4" />
                                    <Grid>
                                        <Border Background="{DynamicResource InputBackgroundBrush}"
                                                BorderBrush="{DynamicResource InputBorderBrush}"
                                                BorderThickness="1"
                                                CornerRadius="4"
                                                Padding="8,6">
                                            <TextBlock x:Name="DetailUnicode"
                                                       Text="-"
                                                       Foreground="{DynamicResource InputForegroundBrush}"
                                                       FontFamily="Consolas"
                                                       FontSize="12" />
                                        </Border>
                                        <Button x:Name="CopyUnicodeButton"
                                                Style="{StaticResource CopyIconButton}"
                                                Click="OnCopyUnicodeClick"
                                                Margin="0,0,4,0"
                                                HorizontalAlignment="Right"
                                                VerticalAlignment="Center">
                                            <icons:Icon IconKind="Copy"
                                                        IconSize="ExtraSmall"
                                                        Foreground="{DynamicResource InputForegroundBrush}" />
                                        </Button>
                                    </Grid>
                                </StackPanel>

                                <!-- 字形 -->
                                <StackPanel Margin="0,0,0,12">
                                    <TextBlock Text="字形"
                                               Foreground="{DynamicResource InputForegroundBrush}"
                                               Opacity="0.6"
                                               FontSize="11"
                                               Margin="0,0,0,4" />
                                    <Grid>
                                        <Border Background="{DynamicResource InputBackgroundBrush}"
                                                BorderBrush="{DynamicResource InputBorderBrush}"
                                                BorderThickness="1"
                                                CornerRadius="4"
                                                Padding="8,6">
                                            <TextBlock x:Name="DetailGlyph"
                                                       Text="-"
                                                       Foreground="{DynamicResource InputForegroundBrush}"
                                                       FontFamily="Consolas"
                                                       FontSize="12" />
                                        </Border>
                                        <Button x:Name="CopyGlyphButton"
                                                Style="{StaticResource CopyIconButton}"
                                                Click="OnCopyGlyphClick"
                                                Margin="0,0,4,0"
                                                HorizontalAlignment="Right"
                                                VerticalAlignment="Center">
                                            <icons:Icon IconKind="Copy"
                                                        IconSize="ExtraSmall"
                                                        Foreground="{DynamicResource InputForegroundBrush}" />
                                        </Button>
                                    </Grid>
                                </StackPanel>

                                <!-- 关键词 -->
                                <StackPanel>
                                    <TextBlock Text="关键词"
                                               Foreground="{DynamicResource InputForegroundBrush}"
                                               Opacity="0.6"
                                               FontSize="11"
                                               Margin="0,0,0,4" />
                                    <ItemsControl x:Name="DetailKeywords">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel Orientation="Horizontal" />
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="{DynamicResource InputBackgroundBrush}"
                                                        BorderBrush="{DynamicResource InputBorderBrush}"
                                                        BorderThickness="1"
                                                        CornerRadius="3"
                                                        Padding="6,3"
                                                        Margin="0,0,4,4">
                                                    <TextBlock Text="{Binding}"
                                                               Foreground="{DynamicResource InputForegroundBrush}"
                                                               FontSize="11" />
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </Border>
            </Grid>

            <!-- 统计信息 - 右下角 -->
            <TextBlock Grid.Row="1"
                       Foreground="{DynamicResource InputForegroundBrush}"
                       Opacity="0.7"
                       FontSize="12"
                       HorizontalAlignment="Right"
                       Margin="0,12,0,0">
                <Run Text="总计" />
                <Run Text="·" />
                <Run Text="{Binding TotalIconCount, Mode=OneWay}" FontWeight="SemiBold" />
                <Run Text="个图标" />
                <Run Text="·" />
                <Run Text="{Binding DisplayedIconCount, Mode=OneWay}" FontWeight="SemiBold" />
                <Run Text="个显示" />
            </TextBlock>
        </Grid>
    </Grid>
</Page>
