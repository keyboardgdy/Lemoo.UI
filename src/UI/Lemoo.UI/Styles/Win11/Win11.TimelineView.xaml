<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:ui="clr-namespace:Lemoo.UI.Controls"
                    xmlns:converters="clr-namespace:Lemoo.UI.Converters">

    <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="pack://application:,,,/Lemoo.UI;component/Styles/Design/Animations.xaml"/>
        <ResourceDictionary Source="pack://application:,,,/Lemoo.UI;component/Styles/Win11/Win11.Tokens.xaml" />
        <ResourceDictionary Source="pack://application:,,,/Lemoo.UI;component/Converters/Converters.xaml" />
    </ResourceDictionary.MergedDictionaries>

    <!-- TimelineNode 状态颜色转换器 -->
    <converters:TimelineNodeStateToColorConverter x:Key="NodeStateToColorConverter" />
    <converters:TimelineNodeStateToIconConverter x:Key="NodeStateToIconConverter" />

    <!-- TimelineView 默认样式 -->
    <Style TargetType="{x:Type ui:TimelineView}">
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="BorderThickness" Value="0" />
        <Setter Property="Padding" Value="0" />
        <Setter Property="NodeSize" Value="24" />
        <Setter Property="LineStroke" Value="{StaticResource Brush.Control.Border}" />
        <Setter Property="LineStrokeThickness" Value="2" />
        <Setter Property="ItemContainerStyle">
            <Setter.Value>
                <Style TargetType="{x:Type ContentPresenter}">
                    <Setter Property="Margin" Value="0,16,0,0" />
                </Style>
            </Setter.Value>
        </Setter>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type ui:TimelineView}">
                    <Border Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            Padding="{TemplateBinding Padding}">
                        <ItemsPresenter />
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- TimelineItem 容器样式 -->
    <Style x:Key="TimelineItemContainerStyle" TargetType="{x:Type ContentPresenter}">
        <Setter Property="Margin" Value="0,0,0,24" />
    </Style>

    <!-- 垂直方向时间线项模板 -->
    <DataTemplate x:Key="VerticalTimelineItemTemplate">
        <Grid MinHeight="60">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- 时间线节点和连接线 -->
            <Grid Grid.Column="0" Width="48" HorizontalAlignment="Left">
                <!-- 连接线 -->
                <Border x:Name="ConnectionLine"
                        Width="{Binding LineStrokeThickness, RelativeSource={RelativeSource AncestorType=ui:TimelineView}}"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Stretch"
                        Background="{Binding LineStroke, RelativeSource={RelativeSource AncestorType=ui:TimelineView}}"
                        Margin="0,24,0,0"
                        Opacity="0.5" />

                <!-- 节点 -->
                <Border x:Name="NodeBorder"
                        Width="{Binding NodeSize, RelativeSource={RelativeSource AncestorType=ui:TimelineView}}"
                        Height="{Binding NodeSize, RelativeSource={RelativeSource AncestorType=ui:TimelineView}}"
                        CornerRadius="12"
                        Background="{DynamicResource Brush.Layer.Background}"
                        BorderBrush="{Binding State, Converter={StaticResource NodeStateToColorConverter}}"
                        BorderThickness="2"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Top"
                        Margin="0,0,0,0">
                    <Border.RenderTransform>
                        <ScaleTransform x:Name="NodeScale" ScaleX="1" ScaleY="1" />
                    </Border.RenderTransform>
                    <ContentPresenter x:Name="NodeIcon"
                                    Content="{Binding Icon}"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Width="{Binding NodeSize, RelativeSource={RelativeSource AncestorType=ui:TimelineView}, Converter={StaticResource SubtractConverter}, ConverterParameter=8}"
                                    Height="{Binding NodeSize, RelativeSource={RelativeSource AncestorType=ui:TimelineView}, Converter={StaticResource SubtractConverter}, ConverterParameter=8}" />
                </Border>
            </Grid>

            <!-- 内容区域 -->
            <Border Grid.Column="1"
                    Padding="16,0,0,0"
                    VerticalAlignment="Top">
                <StackPanel>
                    <!-- 标题 -->
                    <ContentPresenter Content="{Binding Header}"
                                    ContentTemplate="{Binding HeaderTemplate, RelativeSource={RelativeSource AncestorType=ui:TimelineView}}"
                                    ContentTemplateSelector="{Binding HeaderTemplateSelector, RelativeSource={RelativeSource AncestorType=ui:TimelineView}}" />

                    <!-- 日期时间 -->
                    <TextBlock x:Name="DateTimeText"
                               Text="{Binding DateTime, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}"
                               Foreground="{DynamicResource Brush.Text.Secondary}"
                               FontSize="{StaticResource Win11.FontSize.Caption}"
                               Margin="0,4,0,0"
                               Visibility="{Binding DateTime, Converter={StaticResource NullToVisibilityConverter}}" />

                    <!-- 内容 -->
                    <ContentPresenter Content="{Binding Content}"
                                    ContentTemplate="{Binding ContentTemplate, RelativeSource={RelativeSource AncestorType=ui:TimelineView}}"
                                    ContentTemplateSelector="{Binding ContentTemplateSelector, RelativeSource={RelativeSource AncestorType=ui:TimelineView}}"
                                    Margin="0,8,0,0" />
                </StackPanel>
            </Border>
        </Grid>

        <DataTemplate.Triggers>
            <!-- 进行中状态动画 -->
            <DataTrigger Binding="{Binding State}" Value="InProgress">
                <DataTrigger.EnterActions>
                    <BeginStoryboard>
                        <Storyboard RepeatBehavior="Forever">
                            <DoubleAnimation Storyboard.TargetName="NodeBorder"
                                           Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleX)"
                                           From="0.95" To="1.05"
                                           Duration="0:0:1"
                                           AutoReverse="True"
                                           EasingFunction="{StaticResource EasingFunction.EaseInOut}" />
                            <DoubleAnimation Storyboard.TargetName="NodeBorder"
                                           Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleY)"
                                           From="0.95" To="1.05"
                                           Duration="0:0:1"
                                           AutoReverse="True"
                                           EasingFunction="{StaticResource EasingFunction.EaseInOut}" />
                        </Storyboard>
                    </BeginStoryboard>
                </DataTrigger.EnterActions>
            </DataTrigger>

            <!-- 连接线动画 -->
            <DataTrigger Binding="{Binding LineStyle, RelativeSource={RelativeSource AncestorType=ui:TimelineView}}" Value="Animated">
                <DataTrigger.EnterActions>
                    <BeginStoryboard>
                        <Storyboard RepeatBehavior="Forever">
                            <DoubleAnimation Storyboard.TargetName="ConnectionLine"
                                           Storyboard.TargetProperty="Opacity"
                                           From="0.3" To="0.7"
                                           Duration="0:0:1.5"
                                           AutoReverse="True" />
                        </Storyboard>
                    </BeginStoryboard>
                </DataTrigger.EnterActions>
            </DataTrigger>
        </DataTemplate.Triggers>
    </DataTemplate>

    <!-- 水平方向时间线项模板 -->
    <DataTemplate x:Key="HorizontalTimelineItemTemplate">
        <Grid MinWidth="120" Margin="0,0,24,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- 节点和连接线 -->
            <Grid Grid.Row="0" Height="48" VerticalAlignment="Top">
                <!-- 连接线 -->
                <Border x:Name="ConnectionLine"
                        Height="{Binding LineStrokeThickness, RelativeSource={RelativeSource AncestorType=ui:TimelineView}}"
                        VerticalAlignment="Center"
                        HorizontalAlignment="Stretch"
                        Background="{Binding LineStroke, RelativeSource={RelativeSource AncestorType=ui:TimelineView}}"
                        Margin="24,0,0,0"
                        Opacity="0.5" />

                <!-- 节点 -->
                <Border x:Name="NodeBorder"
                        Width="{Binding NodeSize, RelativeSource={RelativeSource AncestorType=ui:TimelineView}}"
                        Height="{Binding NodeSize, RelativeSource={RelativeSource AncestorType=ui:TimelineView}}"
                        CornerRadius="12"
                        Background="{DynamicResource Brush.Layer.Background}"
                        BorderBrush="{Binding State, Converter={StaticResource NodeStateToColorConverter}}"
                        BorderThickness="2"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Center"
                        Margin="0,0,0,0">
                    <ContentPresenter Content="{Binding Icon}"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center" />
                </Border>
            </Grid>

            <!-- 内容区域 -->
            <Border Grid.Row="1"
                    Padding="0,16,0,0"
                    HorizontalAlignment="Left">
                <StackPanel>
                    <!-- 标题 -->
                    <ContentPresenter Content="{Binding Header}" />

                    <!-- 日期时间 -->
                    <TextBlock Text="{Binding DateTime, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}"
                               Foreground="{DynamicResource Brush.Text.Secondary}"
                               FontSize="{StaticResource Win11.FontSize.Caption}"
                               Margin="0,4,0,0" />

                    <!-- 内容 -->
                    <ContentPresenter Content="{Binding Content}"
                                    Margin="0,8,0,0" />
                </StackPanel>
            </Border>
        </Grid>
    </DataTemplate>

</ResourceDictionary>
