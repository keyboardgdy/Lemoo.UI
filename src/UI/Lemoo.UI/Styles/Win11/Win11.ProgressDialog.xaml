<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ui="clr-namespace:Lemoo.UI.Controls">

    <!-- ProgressDialog 默认样式 -->
    <Style TargetType="{x:Type ui:ProgressDialog}" x:Key="{x:Type ui:ProgressDialog}">
        <Setter Property="Background" Value="{DynamicResource Brush.Layer.Background}" />
        <Setter Property="Foreground" Value="{DynamicResource Brush.Text.Primary}" />
        <Setter Property="BorderBrush" Value="{DynamicResource Brush.Card.Border}" />
        <Setter Property="BorderThickness" Value="1" />
        <Setter Property="CornerRadius" Value="8" />
        <Setter Property="Padding" Value="24" />
        <Setter Property="MinWidth" Value="400" />
        <Setter Property="MaxWidth" Value="500" />
        <Setter Property="OverlayOpacity" Value="0.5" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type ui:ProgressDialog}">
                    <ControlTemplate.Resources>
                        <!-- 不确定进度动画 -->
                        <Storyboard x:Key="IndeterminateAnimation" RepeatBehavior="Forever">
                            <DoubleAnimation
                                Storyboard.TargetName="IndeterminateIndicator"
                                Storyboard.TargetProperty="Angle"
                                From="0"
                                To="360"
                                Duration="0:0:1" />
                        </Storyboard>
                    </ControlTemplate.Resources>

                    <Grid>
                        <!-- 遮罩层 -->
                        <Border
                            x:Name="OverlayBorder"
                            Background="{TemplateBinding OverlayBackground}"
                            Opacity="{TemplateBinding OverlayOpacity}"
                            Visibility="Collapsed" />

                        <!-- 对话框容器 -->
                        <Grid
                            x:Name="DialogContainer"
                            HorizontalAlignment="{TemplateBinding DialogHorizontalAlignment}"
                            VerticalAlignment="{TemplateBinding DialogVerticalAlignment}"
                            Margin="20">
                            <Border
                                x:Name="DialogBorder"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="{TemplateBinding CornerRadius}"
                                Padding="{TemplateBinding Padding}"
                                MinWidth="{TemplateBinding MinWidth}"
                                MaxWidth="{TemplateBinding MaxWidth}"
                                Effect="{StaticResource Shadow.Large}"
                                RenderTransformOrigin="0.5,0.5"
                                Visibility="Collapsed">

                                <Border.RenderTransform>
                                    <ScaleTransform x:Name="DialogScale" ScaleX="0.9" ScaleY="0.9" />
                                </Border.RenderTransform>

                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="*" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>

                                    <!-- 标题 -->
                                    <TextBlock
                                        Grid.Row="0"
                                        Text="{TemplateBinding Title}"
                                        FontSize="18"
                                        FontWeight="SemiBold"
                                        Margin="0,0,0,16"
                                        Foreground="{TemplateBinding Foreground}"
                                        Visibility="{TemplateBinding Title, Converter={StaticResource StringToVisibilityConverter}}" />

                                    <!-- 内容区域 -->
                                    <Grid Grid.Row="1">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>

                                        <!-- 进度指示器 -->
                                        <Grid Grid.Row="0" Margin="0,0,0,20">
                                            <!-- 线性进度条 -->
                                            <Grid x:Name="LinearProgressContainer">
                                                <ProgressBar
                                                    x:Name="LinearProgressBar"
                                                    Height="4"
                                                    Minimum="0"
                                                    Maximum="100"
                                                    Value="{TemplateBinding Progress}"
                                                    IsIndeterminate="{TemplateBinding IsIndeterminate}"
                                                    Foreground="{DynamicResource AccentPrimaryBrush}"
                                                    Background="{DynamicResource Brush.Control.Disabled}" />

                                                <!-- 百分比文本 -->
                                                <TextBlock
                                                    x:Name="PercentageText"
                                                    Text="{Binding Progress, StringFormat={}{0:F0}%, RelativeSource={RelativeSource TemplatedParent}}"
                                                    FontSize="14"
                                                    FontWeight="SemiBold"
                                                    HorizontalAlignment="Right"
                                                    VerticalAlignment="Top"
                                                    Margin="0,-24,0,0"
                                                    Foreground="{TemplateBinding Foreground}"
                                                    Visibility="{TemplateBinding ShowPercentage, Converter={StaticResource BoolToVisibilityConverter}}" />
                                            </Grid>

                                            <!-- 圆形进度条 -->
                                            <Grid
                                                x:Name="CircularProgressContainer"
                                                Width="80"
                                                Height="80"
                                                HorizontalAlignment="Center"
                                                Visibility="Collapsed">
                                                <Grid
                                                    x:Name="IndeterminateIndicator"
                                                    Width="60"
                                                    Height="60"
                                                    RenderTransformOrigin="0.5,0.5">
                                                    <Grid.RenderTransform>
                                                        <RotateTransform x:Name="CircularRotate" Angle="0" />
                                                    </Grid.RenderTransform>
                                                    <Ellipse
                                                        Stroke="{DynamicResource Brush.Control.Disabled}"
                                                        StrokeThickness="4"
                                                        Fill="Transparent" />
                                                    <Path
                                                        Stroke="{DynamicResource AccentPrimaryBrush}"
                                                        StrokeThickness="4"
                                                        Fill="Transparent"
                                                        StrokeDashArray="100 0"
                                                        Width="60"
                                                        Height="60">
                                                        <Path.Data>
                                                            <EllipseGeometry
                                                                Center="30,30"
                                                                RadiusX="26"
                                                                RadiusY="26" />
                                                        </Path.Data>
                                                    </Path>
                                                </Grid>

                                                <!-- 圆形进度百分比 -->
                                                <TextBlock
                                                    Text="{Binding Progress, StringFormat={}{0:F0}%, RelativeSource={RelativeSource TemplatedParent}}"
                                                    FontSize="16"
                                                    FontWeight="SemiBold"
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center"
                                                    Foreground="{TemplateBinding Foreground}"
                                                    Visibility="{TemplateBinding ShowPercentage, Converter={StaticResource BoolToVisibilityConverter}}" />
                                            </Grid>
                                        </Grid>

                                        <!-- 消息文本 -->
                                        <TextBlock
                                            Grid.Row="1"
                                            Text="{TemplateBinding Message}"
                                            FontSize="14"
                                            TextWrapping="Wrap"
                                            Margin="0,0,0,8"
                                            Foreground="{TemplateBinding Foreground}" />

                                        <!-- 详细信息文本 -->
                                        <TextBlock
                                            Grid.Row="2"
                                            Text="{TemplateBinding DetailMessage}"
                                            FontSize="12"
                                            Foreground="{DynamicResource Brush.Text.Secondary}"
                                            TextWrapping="Wrap"
                                            Visibility="{TemplateBinding DetailMessage, Converter={StaticResource StringToVisibilityConverter}}" />
                                    </Grid>

                                    <!-- 取消按钮 -->
                                    <Button
                                        Grid.Row="2"
                                        Content="{TemplateBinding CancelButtonText}"
                                        Command="{TemplateBinding CancelCommand}"
                                        HorizontalAlignment="Right"
                                        Margin="0,16,0,0"
                                        Padding="16,8"
                                        Visibility="{TemplateBinding IsCancellable, Converter={StaticResource BoolToVisibilityConverter}}" />
                                </Grid>
                            </Border>
                        </Grid>
                    </Grid>

                    <ControlTemplate.Triggers>
                        <!-- 显示/隐藏对话框 -->
                        <Trigger Property="IsOpen" Value="True">
                            <Setter TargetName="OverlayBorder" Property="Visibility" Value="Visible" />
                            <Setter TargetName="DialogBorder" Property="Visibility" Value="Visible" />
                            <Trigger.EnterActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <!-- 遮罩层淡入 -->
                                        <DoubleAnimation
                                            Storyboard.TargetName="OverlayBorder"
                                            Storyboard.TargetProperty="Opacity"
                                            To="{Binding OverlayOpacity, RelativeSource={RelativeSource TemplatedParent}}"
                                            Duration="0:0:0.2">
                                            <DoubleAnimation.EasingFunction>
                                                <CubicEase EasingMode="EaseOut" />
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>

                                        <!-- 对话框缩放进入 -->
                                        <DoubleAnimation
                                            Storyboard.TargetName="DialogScale"
                                            Storyboard.TargetProperty="ScaleX"
                                            To="1"
                                            Duration="0:0:0.3">
                                            <DoubleAnimation.EasingFunction>
                                                <CubicEase EasingMode="EaseOut" />
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                        <DoubleAnimation
                                            Storyboard.TargetName="DialogScale"
                                            Storyboard.TargetProperty="ScaleY"
                                            To="1"
                                            Duration="0:0:0.3">
                                            <DoubleAnimation.EasingFunction>
                                                <CubicEase EasingMode="EaseOut" />
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>

                                        <!-- 对话框淡入 -->
                                        <DoubleAnimation
                                            Storyboard.TargetName="DialogBorder"
                                            Storyboard.TargetProperty="Opacity"
                                            To="1"
                                            Duration="0:0:0.3">
                                            <DoubleAnimation.EasingFunction>
                                                <CubicEase EasingMode="EaseOut" />
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                    </Storyboard>
                                </BeginStoryboard>
                            </Trigger.EnterActions>
                        </Trigger>

                        <Trigger Property="IsOpen" Value="False">
                            <Trigger.EnterActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <!-- 对话框缩放退出 -->
                                        <DoubleAnimation
                                            Storyboard.TargetName="DialogScale"
                                            Storyboard.TargetProperty="ScaleX"
                                            To="0.9"
                                            Duration="0:0:0.2">
                                            <DoubleAnimation.EasingFunction>
                                                <CubicEase EasingMode="EaseIn" />
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                        <DoubleAnimation
                                            Storyboard.TargetName="DialogScale"
                                            Storyboard.TargetProperty="ScaleY"
                                            To="0.9"
                                            Duration="0:0:0.2">
                                            <DoubleAnimation.EasingFunction>
                                                <CubicEase EasingMode="EaseIn" />
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                    </Storyboard>
                                </BeginStoryboard>
                            </Trigger.EnterActions>
                        </Trigger>

                        <!-- 进度条类型 -->
                        <Trigger Property="ProgressBarType" Value="Linear">
                            <Setter TargetName="LinearProgressContainer" Property="Visibility" Value="Visible" />
                            <Setter TargetName="CircularProgressContainer" Property="Visibility" Value="Collapsed" />
                        </Trigger>

                        <Trigger Property="ProgressBarType" Value="Circular">
                            <Setter TargetName="LinearProgressContainer" Property="Visibility" Value="Collapsed" />
                            <Setter TargetName="CircularProgressContainer" Property="Visibility" Value="Visible" />
                        </Trigger>

                        <!-- 不确定进度动画 -->
                        <MultiTrigger>
                            <MultiTrigger.Conditions>
                                <Condition Property="IsIndeterminate" Value="True" />
                                <Condition Property="ProgressBarType" Value="Circular" />
                            </MultiTrigger.Conditions>
                            <MultiTrigger.EnterActions>
                                <BeginStoryboard Storyboard="{StaticResource IndeterminateAnimation}" />
                            </MultiTrigger.EnterActions>
                        </MultiTrigger>

                        <!-- 点击遮罩层关闭 -->
                        <EventTrigger SourceName="OverlayBorder" RoutedEvent="Mouse.MouseUp">
                            <BeginStoryboard>
                                <Storyboard>
                                    <BooleanAnimationUsingKeyFrames
                                        Storyboard.TargetName="OverlayBorder"
                                        Storyboard.TargetProperty="IsEnabled"
                                        Duration="0">
                                        <DiscreteBooleanKeyFrame KeyTime="0" Value="False" />
                                    </BooleanAnimationUsingKeyFrames>
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

</ResourceDictionary>
